From b99eff9585633d7ee7979477e9d26890148e179c Mon Sep 17 00:00:00 2001
From: Peter Zhigalov <peter.zhigalov@gmail.com>
Date: Sat, 17 Feb 2024 20:25:50 +0700
Subject: [PATCH 15/15] Allow focus for selectable labels on Windows

---
 src/alertpanel.c | 2 ++
 src/headerview.c | 2 ++
 src/setup.c      | 8 ++++++++
 src/sslmanager.c | 2 ++
 4 files changed, 14 insertions(+)

diff --git a/src/alertpanel.c b/src/alertpanel.c
index 723125eb..6f0e67b4 100644
--- a/src/alertpanel.c
+++ b/src/alertpanel.c
@@ -299,7 +299,9 @@ static void alertpanel_create(const gchar *title,
 	gtk_misc_set_alignment(GTK_MISC(label), 0.0, 0.0);
 	gtk_label_set_line_wrap(GTK_LABEL(label), TRUE);
 	gtk_label_set_selectable(GTK_LABEL(label), TRUE);
+#ifndef G_OS_WIN32
 	GTK_WIDGET_UNSET_FLAGS(label, GTK_CAN_FOCUS);
+#endif
 #ifdef G_OS_WIN32
 	{
 		GtkStyle *style;
diff --git a/src/headerview.c b/src/headerview.c
index 85588845..e518eca5 100644
--- a/src/headerview.c
+++ b/src/headerview.c
@@ -123,11 +123,13 @@ HeaderView *headerview_create(void)
 	gtk_label_set_selectable(GTK_LABEL(ng_body_label), TRUE);
 	gtk_label_set_selectable(GTK_LABEL(subject_body_label), TRUE);
 
+#ifndef G_OS_WIN32
 	GTK_WIDGET_UNSET_FLAGS(from_body_label, GTK_CAN_FOCUS);
 	GTK_WIDGET_UNSET_FLAGS(to_body_label, GTK_CAN_FOCUS);
 	GTK_WIDGET_UNSET_FLAGS(cc_body_label, GTK_CAN_FOCUS);
 	GTK_WIDGET_UNSET_FLAGS(ng_body_label, GTK_CAN_FOCUS);
 	GTK_WIDGET_UNSET_FLAGS(subject_body_label, GTK_CAN_FOCUS);
+#endif
 
 	gtk_widget_add_events(from_body_label, GDK_ENTER_NOTIFY_MASK | GDK_LEAVE_NOTIFY_MASK);
 	gtk_widget_add_events(to_body_label, GDK_ENTER_NOTIFY_MASK | GDK_LEAVE_NOTIFY_MASK);
diff --git a/src/setup.c b/src/setup.c
index c8e560f7..889116b5 100644
--- a/src/setup.c
+++ b/src/setup.c
@@ -172,7 +172,9 @@ void setup_mailbox(void)
 	gtk_misc_set_alignment(GTK_MISC(label), 0.0, 0.0);
 	gtk_label_set_line_wrap(GTK_LABEL(label), TRUE);
 	gtk_label_set_selectable(GTK_LABEL(label), TRUE);
+#ifndef G_OS_WIN32
 	GTK_WIDGET_UNSET_FLAGS(label, GTK_CAN_FOCUS);
+#endif
 	MODIFY_LABEL_STYLE();
 
 	vbox = gtk_vbox_new(FALSE, 8);
@@ -195,7 +197,9 @@ void setup_mailbox(void)
 	gtk_label_set_ellipsize(GTK_LABEL(label), PANGO_ELLIPSIZE_MIDDLE);
 #endif
 	gtk_label_set_selectable(GTK_LABEL(label), TRUE);
+#ifndef G_OS_WIN32
 	GTK_WIDGET_UNSET_FLAGS(label, GTK_CAN_FOCUS);
+#endif
 	MODIFY_LABEL_STYLE();
 
 	g_free(fullpath);
@@ -224,7 +228,9 @@ void setup_mailbox(void)
 	gtk_misc_set_alignment(GTK_MISC(label), 0.0, 0.0);
 	gtk_label_set_line_wrap(GTK_LABEL(label), TRUE);
 	gtk_label_set_selectable(GTK_LABEL(label), TRUE);
+#ifndef G_OS_WIN32
 	GTK_WIDGET_UNSET_FLAGS(label, GTK_CAN_FOCUS);
+#endif
 	MODIFY_LABEL_STYLE();
 
 	if (prefs_common.comply_gnome_hig) {
@@ -791,7 +797,9 @@ PrefsAccount *setup_account(void)
 	gtk_misc_set_alignment(GTK_MISC(label), 0.0, 0.0);
 	gtk_label_set_line_wrap(GTK_LABEL(label), TRUE);
 	gtk_label_set_selectable(GTK_LABEL(label), TRUE);
+#ifndef G_OS_WIN32
 	GTK_WIDGET_UNSET_FLAGS(label, GTK_CAN_FOCUS);
+#endif
 	MODIFY_LABEL_STYLE();
 
 	vbox = gtk_vbox_new(FALSE, 8);
diff --git a/src/sslmanager.c b/src/sslmanager.c
index a633710c..f2a6e973 100644
--- a/src/sslmanager.c
+++ b/src/sslmanager.c
@@ -169,7 +169,9 @@ gint ssl_manager_verify_cert(SockInfo *sockinfo, const gchar *hostname,
 	gtk_misc_set_alignment(GTK_MISC(label), 0.0, 0.0);
 	gtk_label_set_line_wrap(GTK_LABEL(label), TRUE);
 	gtk_label_set_selectable(GTK_LABEL(label), TRUE);
+#ifndef G_OS_WIN32
 	GTK_WIDGET_UNSET_FLAGS(label, GTK_CAN_FOCUS);
+#endif
 #ifdef G_OS_WIN32
 	{
 		GtkStyle *style;
-- 
2.43.0.windows.1

